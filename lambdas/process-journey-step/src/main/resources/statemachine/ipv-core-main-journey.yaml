# parent states
END_JOURNEY:
  name: END_JOURNEY
  events:
    next:
      type: basic
      name: next
      targetState: END

CRI_STATE:
  name: CRI_STATE
  events:
    error:
      type: basic
      name: error
      targetState: ERROR
    access-denied:
      type: basic
      name: access-denied
      targetState: PYI_NO_MATCH
    temporarily-unavailable:
      type: basic
      name: temporarily-unavailable
      targetState: PYI_NO_MATCH
    end:
      type: basic
      name: end
      targetState: IPV_SUCCESS_PAGE
    pyi-no-match:
      type: basic
      name: pyi-no-match
      targetState: PYI_NO_MATCH
    pyi-kbv-fail:
      type: basic
      name: pyi-kbv-fail
      targetState: PYI_KBV_FAIL

# Shared states
INITIAL_IPV_JOURNEY:
  name: INIT
  events:
    next:
      type: basic
      name: next
      targetState: CHECK_EXISTING_IDENTITY

F2F_START_PAGE:
  response:
    type: page
    pageId: page-ipv-identity-postoffice-start
  name: F2F_START_PAGE
  events:
    next:
      type: basic
      name: next
      targetState: CRI_CLAIMED_IDENTITY_J4
    end:
      type: basic
      name: end
      targetState: PYI_ESCAPE
    attempt-recovery:
      type: basic
      name: attempt-recovery
      targetState: F2F_START_PAGE

CHECK_EXISTING_IDENTITY:
  response:
    type: journey
    journeyStepId: /journey/check-existing-identity
  name: CHECK_EXISTING_IDENTITY
  events:
    next:
      type: basic
      name: next
      targetState: IPV_IDENTITY_START_PAGE
    reset-identity:
      type: basic
      name: next
      targetState: RESET_IDENTITY
    reuse:
      type: basic
      name: reuse
      targetState: IPV_IDENTITY_REUSE_PAGE
    pending:
      type: basic
      name: pending
      targetState: IPV_IDENTITY_PENDING_PAGE
    pyi-no-match:
      type: basic
      name: pyi-no-match
      targetState: PYI_NO_MATCH
    pyi-kbv-fail:
      type: basic
      name: pyi-kbv-fail
      targetState: PYI_KBV_FAIL
    error:
      type: basic
      name: error
      targetState: ERROR
    attempt-recovery:
      type: basic
      name: attempt-recovery
      targetState: CHECK_EXISTING_IDENTITY

RESET_IDENTITY:
  response:
    type: journey
    journeyStepId: /journey/reset-identity
  name: RESET_IDENTITY
  events:
    next:
      type: basic
      name: next
      targetState: IPV_IDENTITY_START_PAGE
    attempt-recovery:
      type: basic
      name: attempt-recovery
      targetState: RESET_IDENTITY

IPV_IDENTITY_REUSE_PAGE:
  response:
    type: page
    pageId: page-ipv-reuse
  name: IPV_IDENTITY_REUSE_PAGE
  parent: END_JOURNEY
  events:
    attempt-recovery:
      type: basic
      name: attempt-recovery
      targetState: IPV_IDENTITY_REUSE_PAGE

IPV_IDENTITY_PENDING_PAGE:
  response:
    type: page
    pageId: page-ipv-pending
  name: IPV_IDENTITY_PENDING_PAGE
  events:
    attempt-recovery:
      type: basic
      name: attempt-recovery
      targetState: IPV_IDENTITY_PENDING_PAGE

IPV_IDENTITY_START_PAGE:
  response:
    type: page
    pageId: page-ipv-identity-document-start
  name: IPV_IDENTITY_START_PAGE
  events:
    next:
      type: basic
      name: next
      targetState: CRI_DCMAW
      checkIfDisabled:
        dcmaw:
          type: basic
          name: dcmaw-cri-disabled
          targetState: MULTIPLE_DOC_CHECK_PAGE
    end:
      type: basic
      name: end
      targetState: F2F_START_PAGE
      checkIfDisabled:
        f2f:
          type: basic
          name: f2f-cri-disabled
          targetState: PYI_ANOTHER_WAY
    attempt-recovery:
      type: basic
      name: attempt-recovery
      targetState: IPV_IDENTITY_START_PAGE

PYI_ANOTHER_WAY:
  response:
    type: page
    pageId: pyi-another-way
  name: PYI_ANOTHER_WAY
  parent: END_JOURNEY
  events:
    attempt-recovery:
      type: basic
      name: attempt-recovery
      targetState: PYI_ANOTHER_WAY

CRI_DCMAW:
  response:
    type: cri
    criId: dcmaw
  name: CRI_DCMAW
  parent: CRI_STATE
  events:
    next:
      type: basic
      name: dcmaw-success
      targetState: POST_DCMAW_SUCCESS_PAGE
    access-denied:
      type: basic
      name: access-denied
      targetState: MULTIPLE_DOC_CHECK_PAGE
    temporarily-unavailable:
      type: basic
      name: temporarily-unavailable
      targetState: MULTIPLE_DOC_CHECK_PAGE
    fail-with-no-ci:
      type: basic
      name: fail-with-no-ci
      targetState: MULTIPLE_DOC_CHECK_PAGE
    attempt-recovery:
      type: basic
      name: attempt-recovery
      targetState: CRI_DCMAW

MULTIPLE_DOC_CHECK_PAGE:
  response:
    type: page
    pageId: page-multiple-doc-check
  name: MULTIPLE_DOC_CHECK_PAGE
  events:
    ukPassport:
      type: basic
      name: ukPassport
      targetState: CRI_UK_PASSPORT_J2
    drivingLicence:
      type: basic
      name: drivingLicence
      targetState: CRI_DRIVING_LICENCE_J3
    end:
      type: basic
      name: claimedIdentity
      targetState: CRI_CLAIMED_IDENTITY_J4
      checkIfDisabled:
        f2f:
          type: basic
          name: end
          targetState: END
    attempt-recovery:
      type: basic
      name: attempt-recovery
      targetState: MULTIPLE_DOC_CHECK_PAGE

PYI_NO_MATCH:
  response:
    type: page
    pageId: pyi-no-match
  name: PYI_NO_MATCH
  parent: END_JOURNEY
  events:
    attempt-recovery:
      type: basic
      name: attempt-recovery
      targetState: PYI_NO_MATCH

PYI_KBV_FAIL:
  response:
    type: page
    pageId: pyi-kbv-fail
  name: PYI_KBV_FAIL
  parent: END_JOURNEY
  events:
    attempt-recovery:
      type: basic
      name: attempt-recovery
      targetState: PYI_KBV_FAIL

PYI_KBV_THIN_FILE:
  response:
    type: page
    pageId: pyi-kbv-thin-file
  name: PYI_KBV_THIN_FILE
  parent: END_JOURNEY
  events:
    attempt-recovery:
      type: basic
      name: attempt-recovery
      targetState: PYI_KBV_THIN_FILE

PYI_ESCAPE:
  response:
    type: page
    pageId: pyi-escape
  name: PYI_ESCAPE
  events:
    next:
      type: basic
      name: next
      targetState: RESET_IDENTITY
    end:
      type: basic
      name: end
      targetState: END
    attempt-recovery:
      type: basic
      name: attempt-recovery
      targetState: PYI_ESCAPE

ERROR:
  response:
    type: error
    pageId: pyi-technical
    statusCode: 500
  name: ERROR
  parent: END_JOURNEY
  events:
    attempt-recovery:
      type: basic
      name: error
      targetState: ERROR

CORE_SESSION_TIMEOUT:
  response:
    type: page
    pageId: pyi-timeout-unrecoverable
  name: CORE_SESSION_TIMEOUT
  parent: END_JOURNEY
  events:
    attempt-recovery:
      type: basic
      name: attempt-recovery
      targetState: CORE_SESSION_TIMEOUT

IPV_SUCCESS_PAGE:
  response:
    type: page
    pageId: page-ipv-success
  name: IPV_SUCCESS_PAGE
  parent: END_JOURNEY
  events:
    attempt-recovery:
      type: basic
      name: attempt-recovery
      targetState: IPV_SUCCESS_PAGE

END:
  response:
    type: journey
    journeyStepId: /journey/build-client-oauth-response
  name: END

# DCMAW journey (J1)
POST_DCMAW_SUCCESS_PAGE:
  response:
    type: page
    pageId: page-dcmaw-success
  name: POST_DCMAW_SUCCESS_PAGE
  events:
    next:
      type: basic
      name: address
      targetState: CRI_ADDRESS_J1

CRI_ADDRESS_J1:
  response:
    type: cri
    criId: address
  name: CRI_ADDRESS_J1
  parent: CRI_STATE
  events:
    next:
      type: basic
      name: fraud
      targetState: CRI_FRAUD_J1
    attempt-recovery:
      type: basic
      name: address
      targetState: CRI_ADDRESS_J1

CRI_FRAUD_J1:
  response:
    type: cri
    criId: fraud
  name: CRI_FRAUD_J1
  parent: CRI_STATE
  events:
    end:
      type: basic
      name: end
      targetState: IPV_SUCCESS_PAGE
    attempt-recovery:
      type: basic
      name: fraud
      targetState: CRI_FRAUD_J1

# Passport journey (J2)
CRI_UK_PASSPORT_J2:
  response:
    type: cri
    criId: ukPassport
  name: CRI_UK_PASSPORT_J2
  parent: CRI_STATE
  events:
    next:
      type: basic
      name: address
      targetState: CRI_ADDRESS_J2
    access-denied:
      type: basic
      name: access-denied
      targetState: MULTIPLE_DOC_CHECK_PAGE
    attempt-recovery:
      type: basic
      name: ukPassport
      targetState: CRI_UK_PASSPORT_J2

CRI_ADDRESS_J2:
  response:
    type: cri
    criId: address
  name: CRI_ADDRESS_J2
  parent: CRI_STATE
  events:
    next:
      type: basic
      name: fraud
      targetState: CRI_FRAUD_J2
    attempt-recovery:
      type: basic
      name: address
      targetState: CRI_ADDRESS_J2

CRI_FRAUD_J2:
  response:
    type: cri
    criId: fraud
  name: CRI_FRAUD_J2
  parent: CRI_STATE
  events:
    next:
      type: basic
      name: next
      targetState: PRE_KBV_TRANSITION_PAGE_J2
    attempt-recovery:
      type: basic
      name: fraud
      targetState: CRI_FRAUD_J2

PRE_KBV_TRANSITION_PAGE_J2:
  response:
    type: page
    pageId: page-pre-kbv-transition
  name: PRE_KBV_TRANSITION_PAGE_J2
  events:
    next:
      type: basic
      name: kbv
      targetState: CRI_KBV_J2
    attempt-recovery:
      type: basic
      name: attempt-recovery
      targetState: PRE_KBV_TRANSITION_PAGE_J2

CRI_KBV_J2:
  response:
    type: cri
    criId: kbv
  name: CRI_KBV_J2
  parent: CRI_STATE
  events:
    end:
      type: basic
      name: end
      targetState: IPV_SUCCESS_PAGE
    fail-with-no-ci:
      type: basic
      name: fail-with-no-ci
      targetState: PYI_KBV_THIN_FILE
    attempt-recovery:
      type: basic
      name: kbv
      targetState: CRI_KBV_J2

# Driving licence journey (J3)
CRI_DRIVING_LICENCE_J3:
  response:
    type: cri
    criId: drivingLicence
  name: CRI_DRIVING_LICENCE_J3
  parent: CRI_STATE
  events:
    next:
      type: basic
      name: address
      targetState: CRI_ADDRESS_J3
    access-denied:
      type: basic
      name: access-denied
      targetState: MULTIPLE_DOC_CHECK_PAGE
    attempt-recovery:
      type: basic
      name: drivingLicence
      targetState: CRI_DRIVING_LICENCE_J3

CRI_ADDRESS_J3:
  response:
    type: cri
    criId: address
  name: CRI_ADDRESS_J3
  parent: CRI_STATE
  events:
    next:
      type: basic
      name: fraud
      targetState: CRI_FRAUD_J3
    attempt-recovery:
      type: basic
      name: address
      targetState: CRI_ADDRESS_J3

CRI_FRAUD_J3:
  response:
    type: cri
    criId: fraud
  name: CRI_FRAUD_J3
  parent: CRI_STATE
  events:
    next:
      type: basic
      name: next
      targetState: PRE_KBV_TRANSITION_PAGE_J3
    attempt-recovery:
      type: basic
      name: fraud
      targetState: CRI_FRAUD_J3

PRE_KBV_TRANSITION_PAGE_J3:
  response:
    type: page
    pageId: page-pre-kbv-transition
  name: PRE_KBV_TRANSITION_PAGE_J3
  events:
    next:
      type: basic
      name: kbv
      targetState: CRI_KBV_J3
    attempt-recovery:
      type: basic
      name: attempt-recovery
      targetState: PRE_KBV_TRANSITION_PAGE_J3

CRI_KBV_J3:
  response:
    type: cri
    criId: kbv
  name: CRI_KBV_J3
  parent: CRI_STATE
  events:
    end:
      type: basic
      name: end
      targetState: IPV_SUCCESS_PAGE
    fail-with-no-ci:
      type: basic
      name: fail-with-no-ci
      targetState: PYI_KBV_THIN_FILE
    attempt-recovery:
      type: basic
      name: kbv
      targetState: CRI_KBV_J3

# F2F journey (J4)
CRI_CLAIMED_IDENTITY_J4:
  response:
    type: cri
    criId: claimedIdentity
  name: CRI_CLAIMED_IDENTITY_J4
  parent: CRI_STATE
  events:
    next:
      type: basic
      name: address
      targetState: CRI_ADDRESS_J4
    attempt-recovery:
      type: basic
      name: claimedIdentity
      targetState: CRI_CLAIMED_IDENTITY_J4

CRI_ADDRESS_J4:
  response:
    type: cri
    criId: address
  name: CRI_ADDRESS_J4
  parent: CRI_STATE
  events:
    next:
      type: basic
      name: fraud
      targetState: CRI_FRAUD_J4
    attempt-recovery:
      type: basic
      name: address
      targetState: CRI_ADDRESS_J4

CRI_FRAUD_J4:
  response:
    type: cri
    criId: fraud
  name: CRI_FRAUD_J4
  parent: CRI_STATE
  events:
    next:
      type: basic
      name: f2f
      targetState: CRI_F2F_J4
    attempt-recovery:
      type: basic
      name: fraud
      targetState: CRI_FRAUD_J4

CRI_F2F_J4:
  response:
    type: cri
    criId: f2f
  name: CRI_F2F_J4
  parent: CRI_STATE
  events:
    next:
      type: basic
      name: next
      targetState: F2F_HANDOFF_PAGE_J4
    attempt-recovery:
      type: basic
      name: f2f
      targetState: CRI_F2F_J4

F2F_HANDOFF_PAGE_J4:
  response:
    type: page
    pageId: page-face-to-face-handoff
  name: F2F_HANDOFF_PAGE_J4
  events:
    attempt-recovery:
      type: basic
      name: attempt-recovery
      targetState: F2F_HANDOFF_PAGE_J4
