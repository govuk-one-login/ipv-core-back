# Entry points

ERROR:
  events:
    next:
      targetState: ERROR_PAGE
      checkFeatureFlag:
        ticfCriBeta:
          targetState: CALL_TICF_BEFORE_ERROR

ERROR_NO_TICF:
  events:
    next:
      targetState: ERROR_PAGE

# Journey states

CRI_TICF_BEFORE_ERROR:
  response:
    type: process
    lambda: call-ticf-cri
  events:
    next:
      targetState: ERROR_PAGE
    enhanced-verification:
      targetState: ERROR_PAGE
    fail-with-ci:
      targetState: PYI_NO_MATCH
    error:
      targetState: ERROR_PAGE

PYI_NO_MATCH:
  response:
    type: page
    pageId: pyi-no-match
  events:
    next:
      targetState: RETURN_TO_RP

ERROR_PAGE:
  response:
    type: error
    pageId: pyi-technical
    statusCode: 500
  events:
    next:
      targetState: RETURN_TO_RP

RETURN_TO_RP:
  response:
    type: process
    lambda: build-client-oauth-response
