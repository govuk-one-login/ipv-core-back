name: DCMAW and Driving Licence
description: >-
  The combined journey for DCMAW and Driving Licence CRIs.
entryEvents:
  next:
    targetState: CRI_DCMAW
nestedJourneyStates:
  CRI_DCMAW:
    response:
      type: cri
      criId: dcmaw
    parent: CRI_STATE
    events:
      next:
        targetState: POST_DCMAW_SUCCESS_PAGE
      dl-auth-source-check:
        targetState: CRI_DRIVING_LICENCE_AUTH_SOURCE_CHECK
      not-found:
        exitEventToEmit: incomplete-not-found
      access-denied:
        exitEventToEmit: incomplete
      temporarily-unavailable:
        exitEventToEmit: incomplete
      fail-with-no-ci:
        exitEventToEmit: incomplete
      enhanced-verification:
        exitEventToEmit: incomplete

  CRI_DRIVING_LICENCE_AUTH_SOURCE_CHECK:
    response:
      type: cri
      criId: drivingLicence
      context: check_details
    parent: CRI_STATE
    events:
      next:
        targetState: POST_DCMAW_SUCCESS_PAGE
      access-denied:
        targetState: RESET_SESSION_BEFORE_PROVE_ANOTHER_WAY_AFTER_DL
      alternate-doc-invalid-dl:
        targetState: RESET_SESSION_BEFORE_DL_ALT_DOC_MITIGATION

  RESET_SESSION_BEFORE_PROVE_ANOTHER_WAY_AFTER_DL:
    response:
      type: process
      lambda: reset-session-identity
      lambdaInput:
        resetType: ALL
    events:
      next:
        exitEventToEmit: incomplete-invalid-dl

  RESET_SESSION_BEFORE_DL_ALT_DOC_MITIGATION:
    response:
      type: process
      lambda: reset-session-identity
      lambdaInput:
        resetType: ALL
    events:
      next:
        exitEventToEmit: alternate-doc-invalid-dl

  POST_DCMAW_SUCCESS_PAGE:
    response:
      type: page
      pageId: page-dcmaw-success
    events:
      next:
        exitEventToEmit: next
